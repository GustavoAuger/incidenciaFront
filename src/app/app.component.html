<div class="w-full min-h-screen flex flex-col">
    <div class="navbar bg-base-100 shadow-sm px-8 py-2">
        <div class="flex-none">
            <div class="flex items-center cursor-pointer" (click)="navigateToHome()">
                <img src="/assets/images/Head-Logo-1950.png" alt="Logo" class="h-16">
                <div class="ml-4">
                    <p class="text-md">Sistema de Control de</p>
                    <p class="text-sm">Incidencias de Mercadería</p>
                </div>
            </div>
        </div>
        <div class="flex-1"></div>
        <div class="flex items-center gap-4" *ngIf="isAuthenticated && isNotLogin">
            <div class="text-right">
                <p class="text-lg font-semibold">{{ username }}</p>
                <div class="flex items-center gap-2 text-xs text-gray-500 tracking-wide">
                    <button *ngIf="isAdmin" (click)="openAdminModal()" class="btn btn-circle btn-xs p-1 bg-gray-100 hover:bg-gray-200 transition-all duration-200 shadow-sm hover:shadow-md active:shadow-sm active:translate-y-0.5">
                        <i class="fas fa-user-secret text-base"></i>
                    </button>
                    <div class="min-h-[20px] flex items-center">
                        <span *ngIf="isNavbarLoading" class="loading loading-spinner loading-xs"></span>
                        <div *ngIf="!isNavbarLoading" class="flex items-center gap-2">
                            <span class="uppercase">{{ userRol }}</span>
                            <span *ngIf="userRol && userBodega">|</span>
                            <span class="uppercase">{{ userBodega }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <button (click)="onLogout($event)" class="btn btn-outline btn-md">
                Cerrar Sesión
            </button>
        </div>
    </div>
    <div class="flex-grow">
        <router-outlet></router-outlet>
    </div>
    <footer class="footer sm:footer-horizontal footer-center bg-base-300 text-base-content p-4">
        <aside>
            <p>Copyright 2025 - Todos los derechos reservados</p>
        </aside>
    </footer>

    <!-- Admin Modal -->
    <dialog id="adminModal" class="modal">
      <div class="modal-box w-11/12 max-w-2xl">
        <h3 class="font-bold text-lg mb-4">Cambiar Rol</h3>
        
        <div class="form-control w-full max-w-xs mb-4">
          <label class="label">
            <span class="label-text">Rol</span>
          </label>
          <select 
            class="select select-bordered w-full" 
            [(ngModel)]="selectedRoleId"
            (change)="onRoleChange(selectedRoleId)">
            <option [ngValue]="null" disabled>Seleccione un rol...</option>
            <option *ngFor="let rol of modalRoles" [ngValue]="rol.id">{{ rol.nombre | initCapFirst}}</option>
          </select>
        </div>

        <!-- Bodega Dropdown (only shown for Tienda role) -->
        <div class="form-control w-full max-w-xs mt-4" *ngIf="showBodegaDropdown">
          <label class="label">
            <span class="label-text">Bodega</span>
          </label>
          <select 
            class="select select-bordered w-full" 
            [(ngModel)]="selectedBodegaId"
            (change)="onBodegaChange(selectedBodegaId)">
            <option [ngValue]="null" disabled>Seleccione una bodega...</option>
            <option *ngFor="let bodega of tiendaBodegas" 
                    [ngValue]="bodega.id">
              {{ (bodega.id_bodega + ' - ' + (bodega.nombre | initCapFirst)) || 'Bodega ' + bodega.id_bodega }}
            </option>
          </select>
        </div>

        <div class="modal-action">
          <form method="dialog" class="flex gap-2">
            <button class="btn">Cancelar</button>
            <button 
              class="btn text-white" 
              [class.btn-disabled]="!isFormValid"
              [style.background-color]="isFormValid ? '#00bcd4' : ''"
              [style.border-color]="isFormValid ? '#00bcd4' : ''"
              (click)="saveRoleChange()">
              Guardar Cambios
            </button>
          </form>
        </div>
      </div>
    </dialog>
</div>
